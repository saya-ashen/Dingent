(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{16972:()=>{},78071:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(95155),o=r(15886),a=r(89696),l=r(12115);r(16972);var s=r(15267),i=r(79737);function u(){let{threads:e,activeThreadId:t,setActiveThreadId:r,deleteAllThreads:o}=(0,s.xH)();return(0,n.jsxs)("div",{className:"flex flex-col h-screen w-64 bg-indigo-800 text-white p-4",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("button",{onClick:()=>{r((0,i.A)())},className:"w-full px-4 py-2 border border-white/50 rounded-md hover:bg-indigo-700 transition-colors duration-200",children:"+ New Chat"})}),(0,n.jsxs)("div",{className:"flex-grow overflow-y-auto",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2 px-2",children:"History"}),(0,n.jsx)("ul",{className:"space-y-1",children:e.map(e=>(0,n.jsx)("li",{children:(0,n.jsxs)("button",{onClick:()=>r(e.id),className:"w-full text-left px-3 py-2 rounded-md truncate text-sm transition-colors duration-200 ".concat(e.id===t?"bg-indigo-600 font-semibold":"hover:bg-indigo-700/50"),children:[e.title," "]})},e.id))})]}),(0,n.jsx)("button",{onClick:()=>{window.confirm("Are you sure you want to delete all conversations? This action cannot be undone.")&&o()},className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-red-500/50 text-red-300 rounded-md hover:bg-red-500 hover:text-white transition-colors duration-200",children:"Clear All Chats"})]})}var c=r(88145),d=r(84151),m=r(85070),g=r(57931);function f(){let[e]=(0,l.useState)("#6366f1"),{widgets:t}=function(){let{messages:e,setMessages:t}=(0,m.B)(),{threadId:r,agentSession:n,runtimeClient:o}=(0,g.F)(),{threads:a,updateThreadTitle:i}=(0,s.xH)(),[u,c]=(0,l.useState)([]),f=(0,l.useRef)(""),p=(0,l.useRef)(""),h=(0,l.useRef)(""),x=(0,l.useMemo)(()=>a.find(e=>e.id===r),[a,r]),_=(0,l.useRef)(x);(0,l.useEffect)(()=>{r&&(null==n?void 0:n.agentName)&&(r!==f.current||n.agentName!==p.current)&&(async()=>{var e,a,l,s;if(!(null==n?void 0:n.agentName))return;let i=await o.loadAgentState({threadId:r,agentName:n.agentName});if(i.error){console.error("Failed to load agent state:",i.error),f.current=r,p.current=n.agentName;return}let u=null==(a=i.data)||null==(e=a.loadAgentState)?void 0:e.messages;(null==(s=i.data)||null==(l=s.loadAgentState)?void 0:l.threadExists)?(h.current=u||"",f.current=r,p.current=n.agentName,t((0,d.iD)(JSON.parse(u||"[]")))):(t([]),f.current=r,p.current=null==n?void 0:n.agentName)})()},[r,null==n?void 0:n.agentName,o,t]),(0,l.useEffect)(()=>{_.current=x},[x]),(0,l.useEffect)(()=>{if(e&&0!==e.length&&_.current&&x&&"New Chat"===x.title){let t=e.find(e=>"role"in e&&"user"===e.role);if(t&&t.content){let e=t.content.substring(0,50);i(_.current.id,e)}}},[e,i]);let y=(0,l.useMemo)(()=>JSON.stringify([...new Set(e.filter(e=>{var t;return"ActionExecutionMessage"===e.type&&"name"in e&&"show_data"===e.name&&"arguments"in e&&"object"==typeof e.arguments&&null!==e.arguments&&"tool_output_id"in e.arguments&&"string"==typeof e.arguments.tool_output_id&&!!(null==(t=e.arguments.tool_output_id)?void 0:t.length)}).flatMap(e=>{var t;return"arguments"in e&&"object"==typeof e.arguments&&null!==e.arguments&&"tool_output_id"in e.arguments&&"string"==typeof e.arguments.tool_output_id&&!!(null==(t=e.arguments.tool_output_id)?void 0:t.length)&&e.arguments.tool_output_id}))].sort()),[e]);return(0,l.useEffect)(()=>{(async()=>{let t=e.filter(e=>{var t;return"ActionExecutionMessage"===e.type&&"name"in e&&"show_data"===e.name&&"arguments"in e&&"object"==typeof e.arguments&&null!==e.arguments&&"tool_output_id"in e.arguments&&"string"==typeof e.arguments.tool_output_id&&!!(null==(t=e.arguments.tool_output_id)?void 0:t.length)});if(0===t.length)return c([]);try{let e=t.map(async e=>{let t=e.arguments.tool_output_id;try{let e=await fetch("/api/resource/".concat(t));if(!e.ok)return console.error("Failed to fetch resource: ".concat(t,", Status: ").concat(e.status)),[];let r=await e.json();if(!r||!Array.isArray(r.payloads))return console.error("Invalid resource structure for resourceId: ".concat(t)),[];return r.payloads.map(e=>({id:t,type:e.type||"markdown",payload:e,metadata:r.metadata}))}catch(e){return console.error("Error fetching or parsing resource ".concat(t,":"),e),[]}}),r=(await Promise.all(e)).flat();console.log(r),c(r)}catch(e){console.error("An error occurred while fetching widget data:",e),c([])}})()},[y]),{messages:e,widgets:u}}();return(0,o.a)({name:"show_data",description:"",parameters:[{name:"tool_output_id",type:"string",description:"tool_output_id",required:!0}],followUp:!1,handler:async e=>{let{tool_output_id:t}=e}}),(0,n.jsx)("main",{style:{"--copilot-kit-primary-color":e},children:(0,n.jsxs)("div",{className:"flex flex-row w-full h-screen",children:[(0,n.jsx)(u,{})," ",(0,n.jsxs)("div",{className:"relative flex-grow flex",children:[(0,n.jsx)(c.D,{widgets:t}),(0,n.jsx)(a.R,{clickOutsideToClose:!1,defaultOpen:!0,labels:{title:"Popup Assistant",initial:"\uD83D\uDC4B Select a conversation or start a new one!"}})]})]})})}},83157:(e,t,r)=>{Promise.resolve().then(r.bind(r,78071))}},e=>{e.O(0,[901,823,545,392,326,145,441,964,358],()=>e(e.s=83157)),_N_E=e.O()}]);
